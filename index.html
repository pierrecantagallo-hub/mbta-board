<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Central Square - Red Line MBTA Board</title>

<!-- LED-style font -->
<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  background: #000;
  color: #fff;
  font-family: 'VT323', monospace;
  overflow-x: hidden;
}

/* Header / clock */
header {
  background: #DA291C;
  padding: 30px;
  text-align: center;
  font-size: 4rem; /* BIG header */
  font-weight: bold;
  position: relative;
}

#clock {
  position: absolute;
  right: 30px;
  top: 30px;
  font-size: 2rem; /* bigger clock */
}

/* Alerts scrolling */
#alerts {
  background: #111;
  color: #FFD700;
  font-size: 2rem; /* larger alerts */
  padding: 15px 0;
  border-top: 2px solid #444;
  overflow: hidden;
  white-space: nowrap;
}

.scrolling {
  display: inline-block;
  padding-left: 100%;
  animation: scroll 25s linear infinite;
}

@keyframes scroll {
  0% { transform: translateX(0%); }
  100% { transform: translateX(-100%); }
}

/* Train container */
.container {
  display: flex;
  justify-content: space-around;
  padding: 40px;
}

/* Each direction */
.direction {
  width: 45%;
}

.direction h2 {
  font-size: 3rem; /* bigger direction title */
  border-bottom: 2px solid #444;
  padding-bottom: 10px;
  margin-bottom: 20px;
  text-align: center;
}

/* Each train line */
.train {
  font-size: 2.5rem; /* BIG train text */
  margin: 15px 0;
  display: flex;
  justify-content: flex-start;
  align-items: center;
}

.status {
  display: inline-block;
  width: 100px;
  font-weight: bold;
  margin-right: 20px;
  text-align: left;
}

.destination {
  color: #FFD700;
  font-weight: bold;
}

.arriving, .boarding {
  animation: blink 1s infinite;
}

@keyframes blink {
  0%,50%,100% { opacity: 1; }
  25%,75% { opacity: 0; }
}
</style>
</head>
<body>

<header>
  Central Square â€” Red Line
  <div id="clock"></div>
</header>

<div id="alerts"><span class="scrolling" id="alert-text">Loading alerts...</span></div>

<div class="container">
  <div class="direction">
    <h2>Toward Alewife</h2>
    <div id="northbound">Loading...</div>
  </div>

  <div class="direction">
    <h2>Toward Braintree / Ashmont</h2>
    <div id="southbound">Loading...</div>
  </div>
</div>

<script>
const stopId = "place-cntsq";
const routeId = "Red";

function updateClock() {
  const now = new Date();
  document.getElementById("clock").innerText =
    now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
}

function getStatus(departureTime) {
  const now = new Date();
  const diff = (departureTime - now)/60000;
  if(diff <= 0) return 'ARR';
  if(diff <= 1) return 'BRD';
  return Math.round(diff) + ' MIN';
}

async function fetchPredictions() {
  try {
    const response = await fetch(
      `https://api-v3.mbta.com/predictions?filter[stop]=${stopId}&filter[route]=${routeId}&sort=departure_time`
    );
    const data = await response.json();
    const northDiv = document.getElementById("northbound");
    const southDiv = document.getElementById("southbound");
    northDiv.innerHTML = "";
    southDiv.innerHTML = "";

    const north = [];
    const south = [];

    data.data.filter(p => p.attributes.departure_time).forEach(p => {
      const time = new Date(p.attributes.departure_time);
      if(p.attributes.direction_id===0 && north.length<3) north.push({time,dest:"Alewife"});
      if(p.attributes.direction_id===1 && south.length<3) south.push({time,dest:"Braintree / Ashmont"});
    });

    function render(div,list) {
      if(list.length===0){div.innerHTML="<div class='train'>No trains</div>"; return;}
      list.forEach(train=>{
        const statusText = getStatus(train.time);
        const el = document.createElement("div");
        el.className = "train";
        el.innerHTML = `<span class="status ${statusText==='ARR'?'arriving':statusText==='BRD'?'boarding':''}">${statusText}</span> <span class="destination">${train.dest}</span>`;
        div.appendChild(el);
      });
    }

    render(northDiv,north);
    render(southDiv,south);

  } catch(e){console.error("Error fetching predictions:",e);}
}

async function fetchAlerts() {
  try {
    const response = await fetch(`https://api-v3.mbta.com/alerts?filter[route]=${routeId}`);
    const data = await response.json();
    const alertText = data.data.map(a=>a.attributes.header_text||a.attributes.description_text)
      .filter(text=>text && text.trim()!=="").join(' | ');
    document.getElementById("alert-text").innerText = alertText || "No current alerts";
  } catch(e){console.error("Error fetching alerts:",e); document.getElementById("alert-text").innerText="No current alerts";}
}

updateClock();
fetchPredictions();
fetchAlerts();

setInterval(updateClock,1000);
setInterval(fetchPredictions,10000);
setInterval(fetchAlerts,15000);
</script>

</body>
</html>
